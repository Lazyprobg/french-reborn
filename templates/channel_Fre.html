<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- IMPORTANT POUR MOBILE -->
    <title>Channel French Reborn</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="chat-container">

    <div class="messages-container" id="messages-container"></div>

    <div class="chat-input-container">
        <input type="text" id="message-input" placeholder="Ã‰cris un message...">
        <button class="emoji-button" id="emoji-button">ğŸ˜€</button>
        <button class="send-button" id="send-button">Envoyer</button>
    </div>
</div>

<script>
const messagesContainer = document.getElementById("messages-container");
const input = document.getElementById("message-input");
const sendButton = document.getElementById("send-button");
const emojiButton = document.getElementById("emoji-button");

// =====================
// AJOUT MESSAGE AU DOM
// =====================
function addMessage(username, role, text, date = new Date()) {
    const messageDiv = document.createElement("div");
    messageDiv.className = "message";
    messageDiv.innerHTML = `
        <div class="avatar"></div>
        <div class="message-content">
            <div class="role">${role}</div>
            <div class="username">${username}</div>
            <div class="text">${text}</div>
        </div>
    `;
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// =====================
// CHARGEMENT ET RAFRAÃCHISSEMENT
// =====================
function fetchMessages() {
    fetch("/messages")
        .then(res => res.json())
        .then(data => {
            messagesContainer.innerHTML = "";
            data.forEach(msg => addMessage(msg.username, msg.role, msg.content));
        });
}

// RafraÃ®chir toutes les 1 seconde
setInterval(fetchMessages, 1000);

// =====================
// ENVOI MESSAGE
// =====================
function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    fetch("/send_message", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({content: text})
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            input.value = "";
            fetchMessages();
        } else {
            alert("Erreur: " + (data.error || "Impossible d'envoyer le message"));
        }
    });
}

sendButton.addEventListener("click", sendMessage);
input.addEventListener("keypress", e => {
    if (e.key === "Enter") {
        e.preventDefault();
        sendMessage();
    }
});

// =====================
// EMOJIS
// =====================
emojiButton.addEventListener("click", () => {
    const emojiList = ["ğŸ˜€","ğŸ˜‚","ğŸ˜","ğŸ˜","ğŸ‘","ğŸ’™","ğŸš€","âœˆï¸"];
    const chosen = prompt("Choisis un emoji:\n" + emojiList.join(" "));
    if (chosen) {
        input.value += chosen;
        input.focus();
    }
});
</script>

</body>
</html>
